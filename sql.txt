SELECT a.claim_id
FROM attachments a
JOIN claims c ON a.claim_id = c.claim_id
WHERE c.update_user = 'RISK_USER'
  AND c.update_date < CURRENT_DATE - INTERVAL '31 days';

DELETE FROM attachments
WHERE claim_id IN (
    SELECT c.claim_id
    FROM claims c
    WHERE c.update_user = 'RISK_USER'
      AND c.update_date < CURRENT_DATE - INTERVAL '31 days'
);
